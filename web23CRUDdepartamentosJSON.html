<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>

        tr:nth-child(odd) {
            background-color: #f2f2f2; /* Color claro para los impares */
        }

        /* Estilo para los td pares */
        tr:nth-child(even) {
            background-color: #d9d9d9; /* Color m√°s oscuro para los pares */
        }
        table{
            border-collapse: collapse;
            border: 1px solid #908484;
        }
        th{ background-color: #b3b0b0
        }

    </style>
</head>
<body>

<h1>CRUD JSON</h1>
<label>Id Departamentos</label>
<input type="text" id="cajaId">

<label>Nombre</label>
<input type="text" id="cajaNombre">

<label>Localidad</label>
<input type="text" id="cajaLocalidad">

<button id="btnInsert">Insert</button>
<button id="btnUpdate">Update</button>
<button id="btnDelete">Delete</button>

<button id="btnBuscar">Buscar</button>
<table id="tablaDepartamento">
    <thead>
        <tr>
            <th>Id Departamento</th>
            <th>Nombre</th>
            <th>Localidad</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>
<script src="js/jquery-3.7.1.js"></script>
<script>
    let url="https://apicruddepartamentoscore.azurewebsites.net/"
    $(document).ready(function () {


        loadDepartamentos()

        $("#btnInsert").click(function () {

            var numero = parseInt($("#cajaId").val())
            var nombre = $("#cajaNombre").val()
            var localidad = $("#cajaLocalidad").val()

            //NECESITAMOS CREAR UN UEVO OBJETO JAVASCRIPT CON LAS MISMAS
            //PROPIEDADES DINAMICAS DEL JSON
            var departamento=new Object();

            departamento.numero = numero;
            departamento.nombre = nombre;
            departamento.localidad = localidad;

            //CONVERTIMOS EL OBJETO JS A JSON

            var dataJSON=JSON.stringify(departamento);
            console.log(dataJSON);

            var request ="api/Departamentos";
            $.ajax({
                url: url+request,
                method: "POST",
                contentType: "application/json",
                data: dataJSON,
                success: function () {
                    console.log("----INSERTADO----");
                    loadDepartamentos()
                }
            })
        })

        $("#btnUpdate").click(function () {

            var numero = parseInt($("#cajaId").val())
            var nombre = $("#cajaNombre").val()
            var localidad = $("#cajaLocalidad").val()

            var departamento=new Object();

            departamento.numero = numero;
            departamento.nombre = nombre;
            departamento.localidad = localidad;

            var dataJSON=JSON.stringify(departamento);
            var request="api/departamentos";
            $.ajax({
                url: url+request,
                method: "PUT",
                contentType: "application/json",
                data:dataJSON,
                success: function () {
                    console.log("----MODIFICADO----");
                    loadDepartamentos()
                }
            })
        })
        $("#btnDelete").click(function () {
            var numero = parseInt($("#cajaId").val())
            var request="/api/Departamentos/"+numero
            $.ajax({
                url: url+request,
                method: "DELETE",
                contentType: "application/json",
                success: function () {
                    console.log("----BORRADO----");
                    loadDepartamentos()
                }
            })

        })
        $("#btnBuscar").click(function () {
            var numero = parseInt($("#cajaId").val())

            getDepartamento(numero)

        })
    })

    function getDepartamento(id){
        let request="api/departamentos/"+id;
        $.getJSON(url+request,function (data){

            var html="";
            console.log(data);

                html+="<tr>"
                html+="<td>"+data.numero+"</td>"
                html+="<td>"+data.nombre+"</td>"
                html+="<td>"+data.localidad+"</td>"
                html+="</tr>"

            $("#tablaDepartamento tbody").html(html)
        })
    }
    function loadDepartamentos(){
        let request="api/departamentos";

        $.getJSON(url+request, function (data) {
            console.log("--ENTRANDO--")
            var html=""
            $.each(data, function (index, departamento) {
                html+="<tr>"
                html+="<td>"+departamento.numero+"</td>"
                html+="<td>"+departamento.nombre+"</td>"
                html+="<td>"+departamento.localidad+"</td>"
                html+="</tr>"
            })
            $("#tablaDepartamento tbody").html(html)

        })
    }
</script>



</body>
</html>